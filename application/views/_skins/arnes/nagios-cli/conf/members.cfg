{function name=getVlanId vlan=0 found=0}
{foreach $ixp->getCustomers() as $ixpc}
{foreach $ixpc->getVirtualInterfaces() as $vi}
{foreach $vi->getVlanInterfaces() as $vli}
{if $vli->getVlan()->getName() == $vlan}{$vli->getVlan()->getId()}{assign var="found" value=1}{/if}
{if $found}{break}{/if}
{/foreach}
{if $found}{break}{/if}
{/foreach}
{if $found}{break}{/if}
{/foreach}
{/function}

{function name=getAutsys cid=0}
{foreach $ixp->getCustomers() as $ixpc}
{if $ixpc->getId() == $cid}{$ixpc->getAutsys()}{/if}
{/foreach}
{/function}

{function name=getHostname host=0}
{$ixp->getShortname()|lower}-{$host}-{getLocation host=$host}{/function}

{function name=getLocation host=0 safe=0}
{foreach $locations as $locid => $hostnames}
{foreach $hostnames as $hostname}
{if $hostname == $host}
{if $safe==1}{$locid|lower|replace:"-":"_"}{else}{$locid|lower}{/if}{/if}
{/foreach}
{/foreach}
{/function}

{function name=getMembers list=[]}
{foreach $list as $host name=members}{getHostname host=$host}{if not $smarty.foreach.members.last},{/if}{/foreach}
{/function}

{foreach $custs as $c}

###############################################################################################
###
### {$c.name} ({$c.shortname})
###

    {foreach $c.vints as $cliid => $protos}
        {foreach $protos as $proto => $p}
            {if $proto eq 'phys'}{continue}{/if}
            {tmplinclude file='nagios-cli/conf/members-host.cfg'}
            {if $p.canping}
            {tmplinclude file='nagios-cli/conf/members-service-ping.cfg'}
            {/if}
            {if $p.monrc}
            {tmplinclude file='nagios-cli/conf/members-service-rcmon.cfg'}
            {/if}
        {/foreach}
    {/foreach}
    {tmplinclude file='nagios-cli/conf/members-hostgroup-customer.cfg'}

{/foreach}

{tmplinclude file='nagios-cli/conf/members-hostgroup-switches.cfg'}
{tmplinclude file='nagios-cli/conf/members-hostgroup-locations.cfg'}
{tmplinclude file='nagios-cli/conf/members-hostgroup-protocols.cfg'}
{tmplinclude file='nagios-cli/conf/members-hostgroup-all.cfg'}
